extends ../layout/admin.pug

block content
  div(class="mx-auto max-w-2xl px-4 mt-6")
    h1(class="text-3xl font-bold text-gray-900 mb-6")= pagina
    
    if errores
      div(class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg")
        h2(class="font-bold mb-2") Errores encontrados:
        ul(class="list-disc list-inside space-y-1")
          each err in errores
            li(class="text-sm")= err.msg

    div(class="bg-white shadow rounded-lg p-6")
      form(method="POST" action="/admin/productos/nuevo" enctype="multipart/form-data" novalidate)
        input(type="hidden" name="_csrf" value=csrfToken)

        // Nombre
        div(class="mb-5")
          label(for="nombre" class="block text-sm font-medium text-gray-700") Nombre del producto *
          input(type="text" id="nombre" name="nombre" value=(producto && producto.nombre) || "" placeholder="Ej: Laptop Dell" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required)
          p(class="mt-1 text-xs text-gray-500") Campo obligatorio

        // Descripción
        div(class="mb-5")
          label(for="descripcion" class="block text-sm font-medium text-gray-700") Descripción
          textarea(id="descripcion" name="descripcion" placeholder="Describe tu producto..." rows="4" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm")= (producto && producto.descripcion) || ""
          p(class="mt-1 text-xs text-gray-500") Puedes dejar esto en blanco

        // Precio
        div(class="mb-5")
          label(for="precio" class="block text-sm font-medium text-gray-700") Precio (COP) *
          input(type="number" id="precio" step="0.01" min="0" name="precio" value=(producto && producto.precio) || "0.00" placeholder="0.00" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required)
          p(class="mt-1 text-xs text-gray-500") Precio debe ser mayor a 0

        // Stock
        div(class="mb-5")
          label(for="stock" class="block text-sm font-medium text-gray-700") Stock (cantidad) *
          input(type="number" id="stock" min="0" name="stock" value=(producto && producto.stock) || "0" placeholder="0" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" required)
          p(class="mt-1 text-xs text-gray-500") Cantidad disponible

        // Categoría
        div(class="mb-5")
          label(for="categoria_id" class="block text-sm font-medium text-gray-700") Categoría
          select(id="categoria_id" name="categoria_id" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm")
            option(value="") -- Seleccionar una categoría --
            each cat in categorias
              option(value=cat.id selected=(producto && producto.categoria_id==cat.id) data-slug=cat.slug)= cat.nombre
          p(class="mt-1 text-xs text-gray-500") Selecciona una categoría para tu producto

        // Imagen
        div(class="mb-6")
          label(for="imagen" class="block text-sm font-medium text-gray-700") Imagen principal *
          div(class="mt-2 flex items-center justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md")
            div(class="space-y-1 text-center")
              svg(class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48")
                path(d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-12l-3.172-3.172a4 4 0 00-5.656 0L28 20M9 20l3.172-3.172a4 4 0 015.656 0L28 28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
              p(class="text-xs text-gray-500")
                span(class="font-medium text-indigo-600") Haz clic o arrastra
                span  tu imagen aquí
              p(class="text-xs text-gray-500") PNG, JPG, JPEG, GIF (máx 5MB)
              input(type="file" id="imagen" name="imagen" accept="image/*" class="hidden" required)
              label(for="imagen" class="mt-3 inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer") Seleccionar archivo

          if producto && producto.imagen_principal
            div(class="mt-4")
              p(class="text-sm font-medium text-gray-700 mb-2") Vista previa:
              img(src=producto.imagen_principal alt="Imagen del producto" class="rounded-md shadow-sm" style="max-width: 200px; max-height: 200px;")

        // Acciones
        div(class="flex gap-3")
          button(type="submit" class="flex-1 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500") Guardar producto
          a(href="/admin/productos" class="flex-1 flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500") Cancelar
