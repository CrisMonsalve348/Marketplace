extends ../layout/admin.pug

block content
  div(class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 mt-6")
    // Encabezado con acción
    div(class="flex items-center justify-between mb-6")
      h1(class="text-3xl font-bold text-gray-900")= pagina
      a(href="/admin/productos" class="inline-flex items-center px-4 py-2 border border-orange-600 text-orange-600 text-sm font-semibold rounded-full hover:bg-orange-50 transition") Volver al listado
    
    if errores
      div(class="mb-6 p-4 bg-red-100 border border-red-300 text-red-700 rounded-lg")
        h2(class="font-bold mb-2") Errores encontrados:
        ul(class="list-disc list-inside space-y-1")
          each err in errores
            li(class="text-sm")= err.msg

    div(class="bg-white shadow-md rounded-xl p-6 space-y-6")
      form(method="POST" action=`/admin/productos/${producto.id}/editar` enctype="multipart/form-data" novalidate class="space-y-6")
        input(type="hidden" name="_csrf" value=csrfToken)

        // Nombre
        div(class="space-y-1")
          label(for="nombre" class="block text-sm font-semibold text-gray-800") Nombre del producto *
          input(type="text" id="nombre" name="nombre" value=producto.nombre placeholder="Ej: Laptop Dell" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm" required)
          p(class="text-xs text-gray-500") Campo obligatorio

        // Descripción
        div(class="space-y-1")
          label(for="descripcion" class="block text-sm font-semibold text-gray-800") Descripción
          textarea(id="descripcion" name="descripcion" placeholder="Describe tu producto..." rows="4" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm")= producto.descripcion || ""
          p(class="text-xs text-gray-500") Puedes dejar esto en blanco

        // Precio
        div(class="space-y-1 grid grid-cols-1 sm:grid-cols-2 gap-4")
          div(class="space-y-1")
            label(for="precio" class="block text-sm font-semibold text-gray-800") Precio (COP) *
            input(type="number" id="precio" step="0.01" min="0" name="precio" value=producto.precio placeholder="0.00" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm" required)
            p(class="text-xs text-gray-500") Precio debe ser mayor a 0

          div(class="space-y-1")
            label(for="stock" class="block text-sm font-semibold text-gray-800") Stock (cantidad) *
            input(type="number" id="stock" min="0" name="stock" value=producto.stock placeholder="0" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm" required)
            p(class="text-xs text-gray-500") Cantidad disponible

        // Categoría
        div(class="space-y-1")
          label(for="categoria_id" class="block text-sm font-semibold text-gray-800") Categoría
          select(id="categoria_id" name="categoria_id" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm placeholder-gray-400 focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm")
            option(value="") -- Seleccionar una categoría --
            each cat in categorias
              option(value=cat.id selected=(producto.categoria_id == cat.id))= cat.nombre
          p(class="text-xs text-gray-500") Selecciona una categoría para tu producto

        // Estado
        div(class="space-y-1")
          label(for="estado" class="block text-sm font-semibold text-gray-800") Estado
          select(id="estado" name="estado" class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 text-sm")
            option(value="publicado" selected=(producto.estado === 'publicado')) Publicado
            option(value="no publicado" selected=(producto.estado === 'no publicado')) No publicado
            option(value="no disponible" selected=(producto.estado === 'no disponible')) No disponible
          p(class="text-xs text-gray-500") Solo productos publicados serán visibles al público

        // Imagen actual
        if producto.imagen_principal
          div(class="space-y-2")
            label(class="block text-sm font-semibold text-gray-800") Imagen actual
            img(src=producto.imagen_principal alt="Imagen del producto" class="rounded-lg shadow" style="max-width: 200px; max-height: 200px;")

        // Nueva imagen (opcional)
        div(class="space-y-2")
          label(for="imagen" class="block text-sm font-semibold text-gray-800") Cambiar imagen (opcional)
          div(class="flex items-center justify-center px-6 pt-5 pb-6 border-2 border-orange-200 border-dashed rounded-xl bg-orange-50/50")
            div(class="space-y-2 text-center")
              svg(class="mx-auto h-12 w-12 text-orange-400" stroke="currentColor" fill="none" viewBox="0 0 48 48")
                path(d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-12l-3.172-3.172a4 4 0 00-5.656 0L28 20M9 20l3.172-3.172a4 4 0 015.656 0L28 28" stroke-width="2" stroke-linecap="round" stroke-linejoin="round")
              p(class="text-xs text-gray-600")
                span(class="font-semibold text-orange-600") Haz clic o arrastra
                span  tu imagen aquí
              p(class="text-xs text-gray-500") PNG, JPG, JPEG, GIF (máx 5MB)
              input(type="file" id="imagen" name="imagen" accept="image/*" class="hidden")
              label(for="imagen" class="inline-flex items-center px-4 py-2 border border-orange-200 rounded-full shadow-sm text-sm font-semibold text-orange-700 bg-white hover:bg-orange-50 cursor-pointer transition") Seleccionar archivo

        // Acciones
        div(class="flex flex-col sm:flex-row gap-3")
          button(type="submit" class="flex-1 inline-flex justify-center items-center py-2.5 px-4 border border-transparent rounded-full shadow-md text-sm font-semibold text-white bg-orange-600 hover:bg-orange-700 transition") Guardar cambios
          a(href="/admin/productos" class="flex-1 inline-flex justify-center items-center py-2.5 px-4 border border-orange-200 rounded-full shadow text-sm font-semibold text-orange-700 bg-white hover:bg-orange-50 transition") Cancelar
