extends ../../layout/admin.pug

block content
  div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6")
    div(class="flex items-center justify-between mb-8")
      h1(class="text-3xl font-bold text-gray-900") Gestión de Pedidos
      a(href="/admin/pedidos" class="inline-flex items-center px-4 py-2 bg-transparent border border-orange-600 text-orange-600 font-medium rounded-full hover:bg-orange-50 transition cursor-pointer") 
        | Actualizar
    
    // Filtro por estado
    div(class="bg-white shadow rounded-lg p-4 mb-8")
      form(action="/admin/pedidos" method="GET" class="flex flex-wrap items-center gap-4")
        label(class="text-sm font-medium text-gray-700") Filtrar por estado:
        select(name="estado" class="appearance-none block px-3 py-2 border border-gray-300 rounded-full shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm")
          option(value="todos" selected=filtroEstado==='todos') Todos
          each estado in estadosDisponibles
            option(value=estado.valor selected=filtroEstado===estado.valor)= estado.label
        button(type="submit" class="inline-flex items-center px-4 py-2 border border-orange-300 rounded-full text-sm font-medium text-orange-700 bg-white hover:bg-orange-50 transition") Filtrar

    // Lista de pedidos en cards
    if pedidos.length > 0
      div(class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6")
        each pedido in pedidos
          div(class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-4 flex flex-col gap-3")
            // Encabezado
            div(class="flex items-center justify-between")
              span(class="text-xs font-mono text-gray-500") ID: ##{pedido.id}
              - const estadoClases = pedido.estado === 'pendiente' ? 'bg-yellow-100 text-yellow-800' : pedido.estado === 'pagado' ? 'bg-blue-100 text-blue-800' : pedido.estado === 'enviado' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
              span(class=`inline-flex items-center px-2.5 py-0.5 rounded-lg text-xs font-medium ${estadoClases}`)
                case pedido.estado
                  when 'pendiente'
                    | Pendiente
                  when 'pagado'
                    | Pagado
                  when 'enviado'
                    | Enviado
                  when 'cancelado'
                    | Cancelado

            // Cliente
            div
              p(class="text-base font-semibold text-gray-900")= pedido.usuario.nombre
              p(class="text-sm text-gray-600")= pedido.usuario.email

            // Total
            div(class="flex items-center justify-between")
              span(class="text-sm text-gray-500") Total
              span(class="text-xl font-normal text-orange-600")= `$${Math.floor(pedido.total).toLocaleString('es-CO')}`

            // Fecha
            div(class="flex items-center justify-between text-sm text-gray-600")
              span Fecha
              span= new Date(pedido.fecha_creacion).toLocaleDateString('es-CO')

            // Acción
            div(class="flex gap-2 mt-auto")
              a(href=`/admin/pedidos/${pedido.id}` class="w-full inline-flex items-center justify-center px-3 py-2 border border-orange-600 text-orange-600 text-sm font-medium rounded-full hover:bg-orange-50 transition") Ver Detalle

    else
      div(class="bg-white rounded-xl shadow-md p-8 text-center")
        p(class="text-gray-700") No hay pedidos para mostrar.

block scripts
  script.
    // Placeholder para scripts futuros
