extends ../../layout/admin

block content
  .container.mx-auto.px-4.py-8.max-w-2xl
    .flex.justify-between.items-center.mb-6
      h1.text-3xl.font-bold.text-gray-800 Nueva Categoría
      a(href="/admin/categorias" class="text-gray-600 hover:text-gray-900")
        svg(class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24")
          path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18")

    .bg-white.rounded-lg.shadow.p-6
      if errores
        .bg-red-50.border-l-4.border-red-500.p-4.mb-6
          .flex
            .flex-shrink-0
              svg(class="h-5 w-5 text-red-400" fill="currentColor" viewBox="0 0 20 20")
                path(fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd")
            .ml-3
              h3.text-sm.font-medium.text-red-800 Error al guardar
              .mt-2.text-sm.text-red-700
                ul.list-disc.list-inside
                  each error in errores
                    li= error.msg

      form(method="POST" action="/admin/categorias/nueva")
        input(type="hidden" name="_csrf" value=csrfToken)

        .space-y-6
          // Nombre
          div
            label(for="nombre" class="block text-sm font-medium text-gray-700 mb-2") 
              | Nombre de la Categoría 
              span.text-red-500 *
            input#nombre(
              type="text"
              name="nombre"
              value=categoria ? categoria.nombre : ''
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Ej: Electrónica"
            )
            p.mt-1.text-sm.text-gray-500 Entre 2 y 100 caracteres

          // Slug
          div
            label(for="slug" class="block text-sm font-medium text-gray-700 mb-2") 
              | Slug (URL amigable) 
              span.text-red-500 *
            input#slug(
              type="text"
              name="slug"
              value=categoria ? categoria.slug : ''
              required
              pattern="[a-z0-9-]+"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Ej: electronica"
            )
            p.mt-1.text-sm.text-gray-500 Solo letras minúsculas, números y guiones. Ej: ropa-deportiva

          // Descripción
          div
            label(for="descripcion" class="block text-sm font-medium text-gray-700 mb-2") 
              | Descripción
            textarea#descripcion(
              name="descripcion"
              rows="4"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Descripción breve de la categoría (opcional)"
            )= categoria ? categoria.descripcion : ''
            p.mt-1.text-sm.text-gray-500 Opcional. Describe los productos que pertenecen a esta categoría.

          // Estado
          div
            label(for="estado" class="block text-sm font-medium text-gray-700 mb-2") Estado
            select#estado(
              name="estado"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            )
              option(value="activo" selected=!categoria || categoria.estado === 'activo') Activo
              option(value="inactivo" selected=categoria && categoria.estado === 'inactivo') Inactivo
            p.mt-1.text-sm.text-gray-500 Las categorías inactivas no se mostrarán al crear productos

          // Botones
          .flex.gap-4.pt-4
            button(
              type="submit"
              class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors font-medium"
            ) Guardar Categoría
            a(
              href="/admin/categorias"
              class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-6 py-3 rounded-lg transition-colors font-medium text-center"
            ) Cancelar

    script.
      // Auto-generar slug desde el nombre
      const nombreInput = document.getElementById('nombre');
      const slugInput = document.getElementById('slug');
      
      nombreInput.addEventListener('input', function() {
        if (!slugInput.dataset.modified) {
          const slug = this.value
            .toLowerCase()
            .normalize('NFD')
            .replace(/[\u0300-\u036f]/g, '')
            .replace(/[^a-z0-9]+/g, '-')
            .replace(/^-+|-+$/g, '');
          slugInput.value = slug;
        }
      });
      
      slugInput.addEventListener('input', function() {
        slugInput.dataset.modified = 'true';
      });
