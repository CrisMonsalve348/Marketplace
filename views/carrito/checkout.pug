extends ../layout/app.pug

block content
  div(class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-6 mb-12")
    
    // Título
    h1(class="text-3xl font-bold text-gray-900 mb-8") Finalizar Pedido

    // Errores
    if errores && errores.length > 0
      div(class="bg-red-50 border border-red-200 rounded-xl p-4 mb-6")
        h5(class="text-red-800 font-semibold mb-2") Errores:
        ul(class="list-disc list-inside text-red-700 text-sm")
          each error in errores
            li= error.msg

    div(class="grid grid-cols-1 lg:grid-cols-3 gap-8")
      
      // Formulario de datos de envío
      div(class="lg:col-span-2")
        div(class="bg-white rounded-xl shadow-md p-6")
          h2(class="text-xl font-bold text-gray-900 mb-6") Datos de Envío
          
          form(action="/carrito/procesar" method="POST")
            input(type="hidden" name="_csrf" value=csrfToken)
            
            // Dirección de envío
            div(class="mb-6")
              label(for="direccion_envio" class="block text-sm font-medium text-gray-700 mb-2") Dirección de Envío
              textarea(id="direccion_envio" name="direccion_envio" rows="4" placeholder="Ej: Calle 123, Apartamento 456, Ciudad" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-orange-500 focus:border-orange-500 text-sm")= direccion_envio || ''
              small(class="text-gray-500 text-xs") Incluye calle, número, apartamento (si aplica) y ciudad
            
            // Método de pago
            div(class="mb-6")
              label(for="metodo_pago" class="block text-sm font-medium text-gray-700 mb-2") Método de Pago
              select(id="metodo_pago" name="metodo_pago" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-orange-500 focus:border-orange-500 text-sm bg-white shadow-sm appearance-none cursor-pointer" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 20 20%22 fill=%22currentColor%22%3E%3Cpath fill-rule=%22evenodd%22 d=%22M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z%22 clip-rule=%22evenodd%22/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 1rem; padding-right: 2.5rem;")
                option(value="") Selecciona un método
                option(value="contra_entrega") Contra Entrega
                option(value="tarjeta") Tarjeta de Crédito
                option(value="transferencia") Transferencia Bancaria
            
            // Botones
            div(class="flex gap-4")
              a(href="/carrito" class="flex-1 text-center px-6 py-3 border border-orange-200 text-orange-700 text-sm font-semibold rounded-full hover:bg-orange-50 transition")
                | Volver al Carrito
              button(type="submit" class="flex-1 px-6 py-3 bg-orange-600 text-white text-sm font-semibold rounded-full hover:bg-orange-700 transition cursor-pointer")
                | Confirmar Pedido

      // Resumen del pedido
      div(class="lg:col-span-1")
        div(class="bg-white rounded-xl shadow-md p-6 sticky top-6")
          h2(class="text-xl font-bold text-gray-900 mb-6") Resumen del Pedido
          
          // Lista de productos
          div(class="space-y-3 mb-6")
            each item in items
              if item.Producto
                div(class="flex justify-between items-start pb-3 border-b border-gray-100")
                  div(class="flex-1")
                    p(class="text-sm font-medium text-gray-900")= item.Producto.nombre
                    p(class="text-xs text-gray-500")= `Cantidad: ${item.cantidad}`
                  span(class="text-sm font-semibold text-gray-900") $#{Math.trunc(item.precio_unitario * item.cantidad).toLocaleString('es-CO')}
          
          // Subtotal
          div(class="flex justify-between items-center mb-3 pb-3 border-b border-gray-200")
            span(class="text-gray-700") Subtotal:
            span(class="text-lg font-semibold text-gray-900") $#{Math.trunc(Number(subtotal)).toLocaleString('es-CO')}
          
          // Total
          div(class="flex justify-between items-center")
            span(class="text-lg font-bold text-gray-900") Total:
            span(class="text-2xl font-bold text-orange-600") $#{Math.trunc(Number(total)).toLocaleString('es-CO')}
